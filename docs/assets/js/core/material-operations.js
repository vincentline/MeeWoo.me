!function(e){"use strict";e.MeeWoo=e.MeeWoo||{},e.MeeWoo.Core=e.MeeWoo.Core||{};var t={filterTextStyle:function(e){if(!e)return{};for(var t={},i=(e=e.replace(/\/\*[\s\S]*?\*\//g,"")).split(";"),o=["position","top","bottom","left","right","width","height","min-width","min-height","max-width","max-height","flex","flex-grow","flex-shrink","flex-basis","flex-direction","flex-wrap","flex-flow","justify-content","justify-items","justify-self","align-content","align-items","align-self","place-content","place-items","place-self","order","gap","margin","margin-top","margin-right","margin-bottom","margin-left","z-index","transform","transform-origin","float","clear","white-space","overflow","overflow-x","overflow-y","line-height","text-decoration","text-decoration-line","text-decoration-style","text-decoration-color","text-decoration-thickness"],a=0;a<i.length;a++){var r=i[a].trim();if(r){var n=r.indexOf(":");if(-1!==n){var s=r.substring(0,n).trim().toLowerCase(),l=r.substring(n+1).trim();s&&l&&-1===o.indexOf(s)&&(t[s]=l)}}}var d="text"===t["-webkit-background-clip"]||"text"===t["background-clip"],g="transparent"===t.color||"transparent"===t["-webkit-text-fill-color"]||"transparent"===t["text-fill-color"],f=-1!==(t.background||t["background-image"]||"").indexOf("gradient");return d&&!g&&f&&(t.color="transparent",t["-webkit-text-fill-color"]||(t["-webkit-text-fill-color"]="transparent")),t},convertStylesToCssString:function(e){var t="";for(var i in e)e.hasOwnProperty(i)&&(t+=i+":"+e[i]+";");return t},restoreOriginalMaterial:function(t,i){var o,a;if(void 0!==i?"number"==typeof i?(a=t.materialList[i])&&(o=a.imageKey):(o=i,a=t.materialList.find(function(e){return e.imageKey===o})):(o=t.editor.targetKey)&&(a=t.materialList.find(function(e){return e.imageKey===o})),o&&a){if(e.MeeWoo.Core.MaterialState.clearMaterialEditState(t.materialEditStates,o),a.originalUrl?a.previewUrl=a.originalUrl:a.originalData&&(a.previewUrl=a.originalData.startsWith("data:")?a.originalData:"data:image/png;base64,"+a.originalData),a.isReplaced=!1,t.replacedImages){var r=Object.assign({},t.replacedImages);delete r[o],t.replacedImages=r}t.editor&&t.editor.targetKey===o&&(t.editor.showImage=!0,t.editor.showText=!1,t.editor.textContent="示例文案",t.editor.textStyle="color: white;\ntext-shadow: 1px 1px 2px #000000;\nfont-size: 24px;\nfont-weight: bold;",t.editor.textPosX=50,t.editor.textPosY=50,t.editor.textScale=1,t.editor.textAlign="left",t.editor.imageOffsetX=0,t.editor.imageOffsetY=0,t.editor.imageScale=1,t.editor.showRestoreBtn=!1,t.editor.scale=1,t.editor.offsetX=0,t.editor.offsetY=0,t.editor.viewMode="fit-height",t.editor.baseImage=a.originalUrl||a.previewUrl),t.applyReplacedMaterials&&t.applyReplacedMaterials(),t.showToast&&t.showToast("已恢复原图")}},openMaterialEditor:function(t,i){var o=i;if("number"==typeof i&&(o=t.materialList[i]),o){t.loadLibrary&&t.loadLibrary("html2canvas",!0).catch(function(e){}),t.editor.targetKey=o.imageKey,t.editor.show=!0,e.MeeWoo&&e.MeeWoo.Controllers&&e.MeeWoo.Controllers.UserTypeController&&setTimeout(()=>{e.MeeWoo.Controllers.UserTypeController.refresh()},0),t.editor.loading=!1,t.editor.viewMode="fit-height",t.editor.scale=1,t.editor.offsetX=0,t.editor.offsetY=0;var a,r=t.materialEditStates[o.imageKey];r?(t.editor.showImage=r.showImage,t.editor.showText=r.showText,t.editor.textContent=r.textContent||"",t.editor.textStyle=r.textStyle||"",t.editor.textPosX=void 0!==r.textPosX?r.textPosX:50,t.editor.textPosY=void 0!==r.textPosY?r.textPosY:50,t.editor.textScale=void 0!==r.textScale?r.textScale:1,t.editor.textAlign=void 0!==r.textAlign?r.textAlign:"left",t.editor.imageOffsetX=void 0!==r.imageOffsetX?r.imageOffsetX:0,t.editor.imageOffsetY=void 0!==r.imageOffsetY?r.imageOffsetY:0,t.editor.imageScale=void 0!==r.imageScale?r.imageScale:1):(t.editor.showImage=!0,t.editor.showText=!1,t.editor.textContent="示例文案",t.editor.textStyle="color: white;\ntext-shadow: 1px 1px 2px #000000;\nfont-size: 24px;\nfont-weight: bold;",t.editor.textPosX=50,t.editor.textPosY=50,t.editor.textScale=1,t.editor.textAlign="left",t.editor.imageOffsetX=0,t.editor.imageOffsetY=0,t.editor.imageScale=1),t.editor.activeElement="none",t.editor.lastClickElement="none",t.editor.lastClickTime=0,t.editor.baseImageWidth=0,t.editor.baseImageHeight=0,a=o.originalUrl?o.originalUrl:o.originalData?o.originalData.startsWith("data:")?o.originalData:"data:image/png;base64,"+o.originalData:o.previewUrl,t.editor.defaultBaseImage=a,t.updateRestoreBtnState&&t.updateRestoreBtnState(),r&&r.customBaseImage&&(a=r.customBaseImage,r.originalBaseImageWidth&&r.originalBaseImageHeight&&(t.editor.baseImageWidth=r.originalBaseImageWidth,t.editor.baseImageHeight=r.originalBaseImageHeight)),t.editor.baseImage=null,this.loadImage(t,a)}},loadImage:function(e,t){var i=new Image;i.onload=function(){e.editor.baseImageWidth&&e.editor.baseImageHeight||(e.editor.baseImageWidth=i.width,e.editor.baseImageHeight=i.height),e.editor.baseImage=t},i.onerror=function(){},i.crossOrigin="Anonymous",i.src=t},loadAndSetImageDimensions:function(e,t){var i=new Image;i.onload=function(){e.editor.baseImageWidth=i.width,e.editor.baseImageHeight=i.height,e.editor.baseImage=t},i.onerror=function(){},i.crossOrigin="Anonymous",i.src=t},closeMaterialEditor:function(e){e.editor.show=!1},saveMaterialEdit:function(t){var i=!1,o=t.editor,a=o.defaultBaseImage;a&&o.baseImage!==a?i=!0:o.showImage?(o.showText||0!==o.imageOffsetX||0!==o.imageOffsetY||Math.abs(o.imageScale-1)>.001)&&(i=!0):i=!0,i?(t.editor.loading=!0,t.generateEditedMaterial().then(function(i){var o=t.editor.targetKey;if(o){var a=t.materialList.find(function(e){return e.imageKey===o});if(a){if(e.MeeWoo.Core.MaterialState.saveMaterialEditState(t.materialEditStates,o,t.editor),a.previewUrl=i,t.replacedImages[o]=i,a.isReplaced=!0,t.svgaPlayer){var r=new Image;r.onload=function(){t.svgaPlayer.setImage(r,o)},r.src=i}t.editor.show=!1,t.editor.loading=!1,t.showToast&&t.showToast("素材编辑已保存")}}}).catch(function(e){t.editor.loading=!1,t.showToast&&t.showToast("保存失败，请重试")})):t.editor.show=!1}};e.MeeWoo.Core.MaterialOperations=t}(window);