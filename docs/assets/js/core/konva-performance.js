!function(e){"use strict";e.MeeWoo=e.MeeWoo||{},e.MeeWoo.Core=e.MeeWoo.Core||{};var t={createCacheManager:function(){return{caches:{},addToCache:function(e,t){this.caches[e]={data:t,timestamp:Date.now()}},getFromCache:function(e){var t=this.caches[e];return t?(t.timestamp=Date.now(),t.data):null},removeFromCache:function(e){delete this.caches[e]},clearExpiredCache:function(e){var t=Date.now();for(var r in this.caches)this.caches.hasOwnProperty(r)&&t-this.caches[r].timestamp>e&&delete this.caches[r]},clearAllCache:function(){this.caches={}}}},throttle:function(e,t){var r,n,a,c=null,o=0,i=function(){o=Date.now(),c=null,a=e.apply(r,n),c||(r=n=null)};return function(){var h=Date.now(),u=t-(h-o);return r=this,n=arguments,u<=0||u>t?(c&&(clearTimeout(c),c=null),o=h,a=e.apply(r,n),c||(r=n=null)):c||(c=setTimeout(i,u)),a}},debounce:function(e,t,r){var n;return function(){var a=this,c=arguments,o=r&&!n;clearTimeout(n),n=setTimeout(function(){n=null,r||e.apply(a,c)},t),o&&e.apply(a,c)}},createBatchRenderer:function(e){e=e||16;var t=[],r=null,n={addRenderTask:function(e){e&&e instanceof Konva.Layer&&!t.includes(e)&&(t.push(e),this.scheduleRender())},scheduleRender:function(){r||(r=setTimeout(function(){n.executeRender()},e))},executeRender:function(){0!==t.length&&(t.forEach(function(e){try{e.draw()}catch(e){console.error("Error rendering layer:",e)}}),t=[],r=null)},flush:function(){r&&(clearTimeout(r),r=null),this.executeRender()},clearQueue:function(){r&&(clearTimeout(r),r=null),t=[]}};return n},createPerformanceMonitor:function(){return{performanceData:{renderTime:[],eventTime:[],transformTime:[]},startTime:function(e){return{type:e,start:Date.now()}},endTime:function(e){var t=Date.now()-e.start;return this.performanceData[e.type]&&(this.performanceData[e.type].push(t),this.performanceData[e.type].length>100&&this.performanceData[e.type].shift()),t},getAverageTime:function(e){var t=this.performanceData[e];return t&&0!==t.length?t.reduce(function(e,t){return e+t},0)/t.length:0},getMaxTime:function(e){var t=this.performanceData[e];return t&&0!==t.length?Math.max.apply(null,t):0},clearData:function(e){if(e)this.performanceData[e]=[];else for(var t in this.performanceData)this.performanceData.hasOwnProperty(t)&&(this.performanceData[t]=[])},printReport:function(){for(var e in console.log("=== Konva Performance Report ==="),this.performanceData)if(this.performanceData.hasOwnProperty(e)){var t=this.getAverageTime(e),r=this.getMaxTime(e);console.log(e+": avg="+t.toFixed(2)+"ms, max="+r.toFixed(2)+"ms")}}}},isElementInViewport:function(e,t){if(!e||!t)return!1;var r=e.getClientRect(),n=0,a=0,c=t.width(),o=t.height();return!(r.x>n+c||r.x+r.width<n||r.y>a+o||r.y+r.height<a)},optimizeComplexStyles:function(e,t){if(e)if(t){if(e.cache)try{e.cache()}catch(e){console.warn("Error caching element:",e)}e.getAttr("shadowBlur")&&e.setAttr("shadowBlur",Math.min(e.getAttr("shadowBlur"),10))}else if(e.clearCache)try{e.clearCache()}catch(e){console.warn("Error clearing cache:",e)}},initPerformanceOptimizer:function(e){return{cacheManager:this.createCacheManager(),batchRenderer:this.createBatchRenderer(),performanceMonitor:this.createPerformanceMonitor(),stageInstance:e}}};e.MeeWoo.Core.KonvaPerformance=t}(window);