!function(e){"use strict";e.MeeWoo=e.MeeWoo||{},e.MeeWoo.Core=e.MeeWoo.Core||{};var n={init:function(e,n){if("undefined"==typeof Konva)throw new Error("Konva library not loaded");var r=Object.assign({},{width:800,height:600,backgroundColor:null,enableTransform:!0,enableSelection:!0},n),t=this.createStage(e,r),a={stage:t,layers:this.createLayers(t),config:r,isInitialized:!0,currentEditor:null};return this.initEvents(a),a},createStage:function(e,n){return new Konva.Stage({container:e,width:n.width,height:n.height})},createLayers:function(e){var n=new Konva.Layer({name:"backgroundLayer"}),r=new Konva.Layer({name:"editLayer"}),t=new Konva.Layer({name:"helperLayer"}),a=new Konva.Layer({name:"uiLayer"});return e.add(n,r,t,a),{backgroundLayer:n,editLayer:r,helperLayer:t,uiLayer:a}},initEvents:function(n){n.stage;n.eventListeners={resize:this.handleResize.bind(this,n)},e.addEventListener("resize",n.eventListeners.resize)},handleResize:function(e){var n=e.stage,r=n.container();if(r){var t=r.getBoundingClientRect();n.width(t.width),n.height(t.height),n.draw()}},integrateWithState:function(e,n){e.currentEditor=n,n.baseImageWidth&&n.baseImageHeight&&this.updateStageSize(e,n.baseImageWidth,n.baseImageHeight)},updateStageSize:function(e,n,r){var t=e.stage;t.width(n),t.height(r),t.draw()},getLayer:function(e,n){return e.layers[n]||null},redrawLayers:function(e,n){"string"==typeof n&&(n=[n]),n.forEach(function(n){var r=e.layers[n];r&&r.draw()})},redrawAll:function(e){e.stage.draw()},clearAllLayers:function(e){for(var n in e.layers)if(e.layers.hasOwnProperty(n)){var r=e.layers[n];r.removeChildren(),r.draw()}},destroy:function(n){n.eventListeners&&n.eventListeners.resize&&e.removeEventListener("resize",n.eventListeners.resize),n.stage&&n.stage.destroy(),n.isInitialized=!1,n.stage=null,n.layers=null,n.currentEditor=null},createImage:function(e){return new Konva.Image(e)},createText:function(e){return new Konva.Text(e)},createRect:function(e){return new Konva.Rect(e)},createCircle:function(e){return new Konva.Circle(e)},createTransformer:function(e){return new Konva.Transformer(e)}};e.MeeWoo.Core.KonvaEditorCore=n}(window);