NEW_FILE_CODE
<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <title>A-viewer Stage 1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Vue 2 -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <!-- Element UI -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/element-ui@2.15.1/lib/theme-chalk/index.css"
    />
    <script src="https://unpkg.com/element-ui@2.15.1/lib/index.js"></script>
    <!-- SVGA / Lottieï¼Œä¸åŸé¡¹ç›®ä¿æŒä¸€è‡´ -->
    <script src="https://cdn.jsdelivr.net/npm/svgaplayerweb@2.3.1/build/svga.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.7.6/lottie.min.js"></script>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC',
          'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
        background-color: #111;
        color: #f5f5f5;
      }

      body {
        display: flex;
        flex-direction: column;
      }

      #app {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .app-root {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      /* é¡¶éƒ¨æ’­æ”¾åŒºåŸŸ */

      .top-area {
        flex: 1;
        position: relative;
        background-color: #1b1b1d;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      .top-area.drag-hover {
        outline: 2px dashed #409eff;
        outline-offset: -10px;
      }

      .viewer-box {
        position: relative;
        width: 100%;
        height: 100%;
        max-width: 1440px;
        max-height: 900px;
        margin: 0 auto;
        box-sizing: border-box;
        padding: 24px 24px 16px;
      }

      .viewer-inner-wrapper {
        position: relative;
        width: 100%;
        height: 100%;
        background-color: #000;
        border-radius: 8px;
        overflow: hidden;
        cursor: default;
      }

      .viewer-inner {
        width: 100%;
        height: 100%;
        transform-origin: center center;
        /* transform åœ¨ Vue é‡Œé€šè¿‡ :style æ³¨å…¥ */
      }

      .viewer-canvas {
        width: 100%;
        height: 100%;
      }

      .empty-overlay {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #999;
        pointer-events: none;
      }

      .empty-overlay-icon {
        width: 80px;
        height: 80px;
        border-radius: 16px;
        border: 2px dashed #555;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 16px;
        font-size: 32px;
      }

      .empty-overlay-text {
        font-size: 14px;
      }

      /* åº•éƒ¨æµ®å±‚ */

      .bottom-bar {
        height: 160px;
        background-color: #151518;
        border-top: 1px solid #26262a;
        display: flex;
        flex-direction: row;
        align-items: stretch;
        padding: 8px 16px;
        box-sizing: border-box;
      }

      .ad-slot {
        width: 160px;
        border-radius: 8px;
        border: 1px dashed #444;
        color: #666;
        font-size: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 8px;
      }

      .bottom-main {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0;
      }

      .module-tabs {
        display: flex;
        flex-direction: row;
        margin-bottom: 8px;
      }

      .module-tab-btn {
        min-width: 72px;
        padding: 4px 12px;
        margin-right: 8px;
        border-radius: 14px;
        border: 1px solid #333;
        background-color: #1f1f23;
        color: #aaa;
        font-size: 13px;
        cursor: pointer;
        outline: none;
      }

      .module-tab-btn:hover {
        border-color: #409eff;
        color: #e0e0e0;
      }

      /* Press/æ¿€æ´»çŠ¶æ€ */
      .module-tab-btn.is-press {
        background-color: #409eff;
        border-color: #409eff;
        color: #fff;
      }

      .bottom-content {
        flex: 1;
        display: flex;
        flex-direction: row;
        align-items: stretch;
        min-width: 0;
      }

      .bottom-section {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        width: 100%;
      }

      .bottom-row {
        display: flex;
        flex-direction: row;
        align-items: center;
        margin-bottom: 6px;
        font-size: 12px;
      }

      .bottom-row-label {
        width: 72px;
        color: #888;
        flex-shrink: 0;
      }

      .bottom-row-value {
        flex: 1;
        min-width: 0;
        color: #eee;
      }

      .bottom-row-value span {
        margin-right: 12px;
      }

      .bottom-row-controls {
        flex: 1;
        display: flex;
        flex-direction: row;
        align-items: center;
      }

      .bottom-row-controls .el-button {
        margin-right: 8px;
      }

      .bottom-row-controls .el-slider {
        flex: 1;
      }

      .bottom-footer-row {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        margin-top: 4px;
      }

      .bottom-footer-left {
        font-size: 12px;
        color: #777;
      }

      .bottom-footer-right {
        display: flex;
        align-items: center;
      }

      .bottom-footer-right .el-button {
        margin-left: 8px;
      }

      .empty-tip-text {
        font-size: 12px;
        color: #777;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <div class="app-root">
        <!-- é¡¶éƒ¨æ’­æ”¾åŒºåŸŸ -->
        <div
          class="top-area"
          :class="{'drag-hover': dropHover}"
          @dragover.prevent="onDragOver"
          @dragleave="onDragLeave"
          @drop.prevent="onDrop"
        >
          <div class="viewer-box">
            <div
              class="viewer-inner-wrapper"
              @wheel="onWheel"
              @mousedown="onMouseDown"
              @mousemove="onMouseMove"
              @mouseup="onMouseUp"
              @mouseleave="onMouseUp"
            >
              <div
                class="viewer-inner"
                :style="viewerTransformStyle"
              >
                <!-- è¿™é‡Œæ˜¯æ‰€æœ‰æ¨¡å—å…±äº«çš„ç”»å¸ƒå®¹å™¨ -->
                <div
                  ref="svgaContainer"
                  class="viewer-canvas"
                  :style="{backgroundColor: currentBgColor}"
                ></div>
                <!-- æœªæ¥å¯ä»¥åœ¨è¿™é‡Œæ ¹æ®æ¨¡å—åˆ‡æ¢ä¸åŒæ¸²æŸ“æ–¹å¼ï¼ˆsvga / video / lottieï¼‰ -->
              </div>

              <!-- ç©ºçŠ¶æ€è¦†ç›–å±‚ï¼ˆæ‰€æœ‰æ¨¡å—éƒ½æ— æ–‡ä»¶æ—¶ï¼‰ -->
              <div v-if="isEmpty" class="empty-overlay">
                <div class="empty-overlay-icon">ğŸ“</div>
                <div class="empty-overlay-text">è¯·å°†æ–‡ä»¶æ‹–åˆ°æ­¤åŒºåŸŸ</div>
              </div>
            </div>
          </div>
        </div>

        <!-- åº•éƒ¨æµ®å±‚ -->
        <div class="bottom-bar">
          <div class="ad-slot">å¹¿å‘Šä½</div>

          <div class="bottom-main">
            <!-- æ¨¡å—åˆ‡æ¢ -->
            <div class="module-tabs">
              <button
                class="module-tab-btn"
                :class="{'is-press': currentModule === 'svga'}"
                @click="switchModule('svga')"
              >
                SVGA
              </button>
              <button
                class="module-tab-btn"
                :class="{'is-press': currentModule === 'yyeva'}"
                @click="switchModule('yyeva')"
              >
                YYEVA MP4
              </button>
              <button
                class="module-tab-btn"
                :class="{'is-press': currentModule === 'lottie'}"
                @click="switchModule('lottie')"
              >
                Lottie
              </button>
            </div>

            <div class="bottom-content">
              <div class="bottom-section">
                <!-- å½“å‰æ¨¡å—å†…å®¹åŒº -->
                <!-- SVGA æ¨¡å— -->
                <template v-if="currentModule === 'svga' || (isEmpty && currentModule === 'empty')">
                  <!-- æ’­æ”¾æ§åˆ¶åŒºåŸŸ -->
                  <div class="bottom-row">
                    <div class="bottom-row-label">æ’­æ”¾æ§åˆ¶</div>
                    <div class="bottom-row-controls">
                      <el-button
                        size="mini"
                        type="primary"
                        :disabled="!svga.hasFile"
                        @click="toggleSvgaPlay"
                      >
                        {{ svga.playing ? 'æš‚åœ' : 'æ’­æ”¾' }}
                      </el-button>
                      <el-slider
                        v-model="svga.progress"
                        :min="0"
                        :max="100"
                        :step="1"
                        :disabled="!svga.hasFile"
                        @change="onSvgaSeek"
                      ></el-slider>
                    </div>
                  </div>

                  <!-- æ–‡ä»¶ä¿¡æ¯åŒºåŸŸ -->
                  <div class="bottom-row">
                    <div class="bottom-row-label">æ–‡ä»¶ä¿¡æ¯</div>
                    <div class="bottom-row-value">
                      <span>åç§°ï¼š{{ svga.fileInfo.name || '-' }}</span>
                      <span>å¤§å°ï¼š{{ svga.fileInfo.sizeText || '-' }}</span>
                    </div>
                  </div>

                  <div class="bottom-row">
                    <div class="bottom-row-label"></div>
                    <div class="bottom-row-value">
                      <span>å¸§ç‡ï¼š{{ svga.fps || '-' }}</span>
                      <span>æ€»å¸§æ•°ï¼š{{ svga.totalFrames || '-' }}</span>
                      <span>å°ºå¯¸ï¼š{{ svga.sizeText || '-' }}</span>
                      <span>å†…å­˜ï¼š{{ svga.memoryText || '-' }}</span>
                    </div>
                  </div>

                  <!-- åº•è‰²åˆ‡æ¢ -->
                  <div class="bottom-row">
                    <div class="bottom-row-label">åº•è‰²</div>
                    <div class="bottom-row-value">
                      <el-radio-group
                        v-model="bgColorKey"
                        size="mini"
                      >
                        <el-radio-button label="black">é»‘</el-radio-button>
                        <el-radio-button label="white">ç™½</el-radio-button>
                        <el-radio-button label="gray">ç°</el-radio-button>
                      </el-radio-group>
                    </div>
                  </div>

                  <!-- åº•éƒ¨è¯´æ˜ + æ¸…ç©ºæŒ‰é’® -->
                  <div class="bottom-footer-row">
                    <div class="bottom-footer-left">
                      <span
                        v-if="isEmpty"
                        class="empty-tip-text"
                      >
                        ç©ºçŠ¶æ€ï¼šè¯·å°†æ–‡ä»¶æ‹–åˆ°ä¸Šæ–¹æ’­æ”¾åŒºåŸŸ
                      </span>
                      <span
                        v-else
                        class="empty-tip-text"
                      >
                        å½“å‰æ¨¡å—ï¼šSVGA
                      </span>
                    </div>
                    <div class="bottom-footer-right">
                      <el-button
                        size="mini"
                        @click="clearAll"
                      >
                        æ¸…ç©ºç”»å¸ƒ
                      </el-button>
                    </div>
                  </div>
                </template>

                <!-- YYEVA æ¨¡å—ï¼ˆé˜¶æ®µ1å…ˆå ä½ï¼‰ -->
                <template v-else-if="currentModule === 'yyeva'">
                  <div class="bottom-row">
                    <div class="bottom-row-label">æ’­æ”¾æ§åˆ¶</div>
                    <div class="bottom-row-controls">
                      <el-button
                        size="mini"
                        type="primary"
                        :disabled="!yyeva.hasFile"
                      >
                        æ’­æ”¾ï¼ˆå¾…å®ç°ï¼‰
                      </el-button>
                    </div>
                  </div>

                  <div class="bottom-row">
                    <div class="bottom-row-label">æ–‡ä»¶ä¿¡æ¯</div>
                    <div class="bottom-row-value">
                      <span>åç§°ï¼š{{ yyeva.fileInfo.name || '-' }}</span>
                      <span>å¤§å°ï¼š{{ yyeva.fileInfo.sizeText || '-' }}</span>
                    </div>
                  </div>

                  <div class="bottom-footer-row">
                    <div class="bottom-footer-left">
                      <span class="empty-tip-text">
                        YYEVA MP4 æ¨¡å—åŠŸèƒ½å°†åœ¨åç»­é˜¶æ®µè¡¥å……ï¼ˆæš‚ä¸ºå ä½ï¼‰
                      </span>
                    </div>
                    <div class="bottom-footer-right">
                      <el-button
                        size="mini"
                        @click="clearAll"
                      >
                        æ¸…ç©ºç”»å¸ƒ
                      </el-button>
                    </div>
                  </div>
                </template>

                <!-- Lottie æ¨¡å—ï¼ˆé˜¶æ®µ1å…ˆå ä½ï¼‰ -->
                <template v-else-if="currentModule === 'lottie'">
                  <div class="bottom-row">
                    <div class="bottom-row-label">æ’­æ”¾æ§åˆ¶</div>
                    <div class="bottom-row-controls">
                      <el-button
                        size="mini"
                        type="primary"
                        :disabled="!lottie.hasFile"
                      >
                        æ’­æ”¾ï¼ˆå¾…å®ç°ï¼‰
                      </el-button>
                    </div>
                  </div>

                  <div class="bottom-row">
                    <div class="bottom-row-label">æ–‡ä»¶ä¿¡æ¯</div>
                    <div class="bottom-row-value">
                      <span>åç§°ï¼š{{ lottie.fileInfo.name || '-' }}</span>
                      <span>å¤§å°ï¼š{{ lottie.fileInfo.sizeText || '-' }}</span>
                    </div>
                  </div>

                  <div class="bottom-footer-row">
                    <div class="bottom-footer-left">
                      <span class="empty-tip-text">
                        Lottie æ¨¡å—åŠŸèƒ½å°†åœ¨åç»­é˜¶æ®µè¡¥å……ï¼ˆæš‚ä¸ºå ä½ï¼‰
                      </span>
                    </div>
                    <div class="bottom-footer-right">
                      <el-button
                        size="mini"
                        @click="clearAll"
                      >
                        æ¸…ç©ºç”»å¸ƒ
                      </el-button>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </div>

          <div class="ad-slot">å¹¿å‘Šä½</div>
        </div>
      </div>
    </div>

    <script>
      new Vue({
        el: '#app',
        data: function () {
          return {
            currentModule: 'empty', // 'empty' | 'svga' | 'yyeva' | 'lottie'
            dropHover: false,

            // è§†å›¾æ“ä½œï¼ˆç¼©æ”¾ + å¹³ç§»ï¼‰
            viewerScale: 1,
            viewerOffsetX: 0,
            viewerOffsetY: 0,
            dragging: false,
            dragStartX: 0,
            dragStartY: 0,
            dragStartOffsetX: 0,
            dragStartOffsetY: 0,

            // åº•è‰²
            bgColorKey: 'black',

            // SVGA çŠ¶æ€
            svga: {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: ''
              },
              fps: null,
              totalFrames: null,
              width: null,
              height: null,
              memoryMB: null,
              memoryText: '',
              sizeText: '',
              progress: 0,
              playing: false
            },

            // YYEVA çŠ¶æ€ï¼ˆé˜¶æ®µ1å ä½ï¼‰
            yyeva: {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: ''
              }
            },

            // Lottie çŠ¶æ€ï¼ˆé˜¶æ®µ1å ä½ï¼‰
            lottie: {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: ''
              }
            },

            // æ’­æ”¾å™¨å®ä¾‹
            svgaPlayer: null,
            svgaParser: null,
            svgaObjectUrl: null
          };
        },
        computed: {
          isEmpty: function () {
            return !this.svga.hasFile && !this.yyeva.hasFile && !this.lottie.hasFile;
          },
          viewerTransformStyle: function () {
            return {
              transform:
                'translate(' +
                this.viewerOffsetX +
                'px,' +
                this.viewerOffsetY +
                'px) scale(' +
                this.viewerScale +
                ')'
            };
          },
          currentBgColor: function () {
            if (this.bgColorKey === 'white') return '#ffffff';
            if (this.bgColorKey === 'gray') return '#333333';
            return '#000000';
          }
        },
        methods: {
          /* æ‹–æ‹½ä¸Šä¼  */

          onDragOver: function () {
            this.dropHover = true;
          },
          onDragLeave: function () {
            this.dropHover = false;
          },
          onDrop: function (event) {
            this.dropHover = false;
            var files = event.dataTransfer && event.dataTransfer.files;
            if (!files || !files.length) return;
            var file = files[0];
            var name = (file.name || '').toLowerCase();

            if (name.endsWith('.svga')) {
              this.loadSvga(file);
            } else if (name.endsWith('.json')) {
              // å…ˆåªè®°å½•æ–‡ä»¶ä¿¡æ¯ï¼Œåç»­é˜¶æ®µå†å®ç°æ’­æ”¾
              this.loadLottiePlaceholder(file);
            } else if (name.endsWith('.mp4')) {
              // å…ˆåªè®°å½•æ–‡ä»¶ä¿¡æ¯ï¼Œåç»­é˜¶æ®µå†å®ç° yyeva æ’­æ”¾
              this.loadYyevaPlaceholder(file);
            } else {
              this.$message.error('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼Œåªæ”¯æŒ .svga / .json / .mp4');
            }
          },

          /* æ¨¡å—åˆ‡æ¢ */
          switchModule: function (key) {
            if (key === 'svga') {
              this.currentModule = this.svga.hasFile ? 'svga' : 'svga';
            } else if (key === 'yyeva') {
              this.currentModule = this.yyeva.hasFile ? 'yyeva' : 'yyeva';
            } else if (key === 'lottie') {
              this.currentModule = this.lottie.hasFile ? 'lottie' : 'lottie';
            }
            // å¦‚æœä¸€ä¸ªæ–‡ä»¶éƒ½æ²¡æœ‰ï¼Œæ•´ä½“çŠ¶æ€ä»ç„¶æ˜¯â€œç©ºâ€çš„ï¼Œåªæ˜¯å½“å‰ tab é«˜äº®
            if (this.isEmpty) {
              this.currentModule = 'svga'; // é»˜è®¤åœç•™åœ¨ SVGA
            }
          },

          /* æ¸…ç©ºç”»å¸ƒï¼ˆä¸‰ä¸ªæ¨¡å—ä¸€èµ·æ¸…ç©ºï¼‰ */
          clearAll: function () {
            // åœæ­¢ SVGA æ’­æ”¾
            if (this.svgaPlayer) {
              try {
                this.svgaPlayer.stopAnimation();
                this.svgaPlayer.clear();
              } catch (e) {}
            }
            if (this.svgaObjectUrl) {
              URL.revokeObjectURL(this.svgaObjectUrl);
              this.svgaObjectUrl = null;
            }

            // é‡ç½®çŠ¶æ€
            this.svga = {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: ''
              },
              fps: null,
              totalFrames: null,
              width: null,
              height: null,
              memoryMB: null,
              memoryText: '',
              sizeText: '',
              progress: 0,
              playing: false
            };
            this.yyeva = {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: ''
              }
            };
            this.lottie = {
              hasFile: false,
              file: null,
              fileInfo: {
                name: '',
                size: 0,
                sizeText: ''
              }
            };

            this.currentModule = 'svga';
          },

          /* SVGA åŠ è½½ä¸æ’­æ”¾ */

          initSvgaPlayer: function () {
            var container = this.$refs.svgaContainer;
            if (!container) return;
            this.svgaPlayer = new SVGA.Player(container);
            this.svgaParser = new SVGA.Parser();
          },

          loadSvga: function (file) {
            var _this = this;
            this.currentModule = 'svga';

            this.svga.hasFile = true;
            this.svga.file = file;
            this.svga.fileInfo.name = file.name;
            this.svga.fileInfo.size = file.size;
            this.svga.fileInfo.sizeText = this.formatBytes(file.size);

            // é‡ç½®æ’­æ”¾ç›¸å…³ä¿¡æ¯
            this.svga.progress = 0;
            this.svga.playing = false;
            this.svga.fps = null;
            this.svga.totalFrames = null;
            this.svga.width = null;
            this.svga.height = null;
            this.svga.memoryMB = null;
            this.svga.memoryText = '';
            this.svga.sizeText = '';

            // è¯»å–æ–‡ä»¶ -> Blob URL -> äº¤ç»™ SVGA.Parser.load
            var reader = new FileReader();
            reader.onload = function (e) {
              var arrayBuffer = e.target.result;
              var blob = new Blob([arrayBuffer], { type: 'application/octet-stream' });
              if (_this.svgaObjectUrl) {
                URL.revokeObjectURL(_this.svgaObjectUrl);
              }
              _this.svgaObjectUrl = URL.createObjectURL(blob);

              _this.svgaParser.load(
                _this.svgaObjectUrl,
                function (videoItem) {
                  _this.onSvgaLoaded(videoItem);
                },
                function () {
                  _this.$message.error('SVGA è§£æå¤±è´¥');
                }
              );
            };
            reader.readAsArrayBuffer(file);
          },

          onSvgaLoaded: function (videoItem) {
            if (!this.svgaPlayer) {
              this.initSvgaPlayer();
            }
            if (!this.svgaPlayer) return;

            // è¯»å–å…ƒä¿¡æ¯ï¼ˆè¯¥ç»“æ„æ¥è‡ª SVGA VideoEntityï¼‰
            try {
              if (videoItem.videoSize) {
                this.svga.width = videoItem.videoSize.width || null;
                this.svga.height = videoItem.videoSize.height || null;
              }
              this.svga.fps = videoItem.FPS || videoItem.fps || null;
              this.svga.totalFrames =
                videoItem.frames || videoItem.framesCount || videoItem.framesLength || null;

              if (this.svga.width && this.svga.height) {
                this.svga.sizeText = this.svga.width + ' Ã— ' + this.svga.height;
              }

              if (this.svga.width && this.svga.height && this.svga.totalFrames) {
                var bytes =
                  this.svga.width * this.svga.height * 4 * this.svga.totalFrames; // ç²—ç•¥ä¼°ç®—
                this.svga.memoryMB = bytes / 1024 / 1024;
                this.svga.memoryText = this.svga.memoryMB.toFixed(2) + ' MB';
              }
            } catch (e) {
              // å…ƒæ•°æ®è¯»å–å¤±è´¥ä¸å½±å“æ’­æ”¾
            }

            var _this = this;

            this.svgaPlayer.setVideoItem(videoItem);
            this.svgaPlayer.setContentMode('AspectFit');
            this.svgaPlayer.clearDynamicObjects();

            // ç»‘å®šå›è°ƒï¼Œæ›´æ–°è¿›åº¦
            this.svgaPlayer.onFrame(function (frame) {
              if (_this.svga.totalFrames && _this.svga.totalFrames > 1) {
                var p = (frame / (_this.svga.totalFrames - 1)) * 100;
                _this.svga.progress = Math.max(0, Math.min(100, Math.round(p)));
              }
            });

            this.svgaPlayer.onFinished(function () {
              _this.svga.playing = false;
            });

            // å¼€å§‹æ’­æ”¾
            this.svgaPlayer.startAnimation();
            this.svga.playing = true;
          },

          toggleSvgaPlay: function () {
            if (!this.svgaPlayer || !this.svga.hasFile) return;
            if (this.svga.playing) {
              try {
                this.svgaPlayer.pauseAnimation();
              } catch (e) {}
              this.svga.playing = false;
            } else {
              try {
                // è¿™é‡Œç®€å•å¤„ç†ï¼šé‡æ–°æ’­æ”¾ï¼ˆåç»­å¯ä»¥ç”¨ stepToPercentage ç»§ç»­æ’­æ”¾ï¼‰
                this.svgaPlayer.startAnimation();
              } catch (e) {}
              this.svga.playing = true;
            }
          },

          onSvgaSeek: function (val) {
            if (!this.svgaPlayer || !this.svga.hasFile) return;
            var p = (val || 0) / 100;
            try {
              this.svgaPlayer.stepToPercentage(p, this.svga.playing);
            } catch (e) {}
          },

          /* Lottie / YYEVA é˜¶æ®µ1å ä½é€»è¾‘ï¼Œåªè®°å½•æ–‡ä»¶ä¿¡æ¯ */

          loadLottiePlaceholder: function (file) {
            this.lottie.hasFile = true;
            this.lottie.file = file;
            this.lottie.fileInfo.name = file.name;
            this.lottie.fileInfo.size = file.size;
            this.lottie.fileInfo.sizeText = this.formatBytes(file.size);
            this.currentModule = 'lottie';
            this.$message.info('Lottie æ¨¡å—å°†åœ¨åç»­é˜¶æ®µå®ç°æ’­æ”¾é€»è¾‘');
          },

          loadYyevaPlaceholder: function (file) {
            this.yyeva.hasFile = true;
            this.yyeva.file = file;
            this.yyeva.fileInfo.name = file.name;
            this.yyeva.fileInfo.size = file.size;
            this.yyeva.fileInfo.sizeText = this.formatBytes(file.size);
            this.currentModule = 'yyeva';
            this.$message.info('YYEVA MP4 æ¨¡å—å°†åœ¨åç»­é˜¶æ®µå®ç°æ’­æ”¾é€»è¾‘');
          },

          /* ç¼©æ”¾ + å¹³ç§» */

          onWheel: function (event) {
            // Ctrl + æ»šè½® ç¼©æ”¾
            if (!event.ctrlKey) return;
            event.preventDefault();
            var delta = event.deltaY || event.wheelDelta;
            var step = delta > 0 ? -0.1 : 0.1;
            var next = this.viewerScale + step;
            if (next < 0.2) next = 0.2;
            if (next > 5) next = 5;
            this.viewerScale = next;
          },

          onMouseDown: function (event) {
            // é¼ æ ‡ä¸­é”®æ‹–åŠ¨
            if (event.button !== 1) return;
            event.preventDefault();
            this.dragging = true;
            this.dragStartX = event.clientX;
            this.dragStartY = event.clientY;
            this.dragStartOffsetX = this.viewerOffsetX;
            this.dragStartOffsetY = this.viewerOffsetY;
          },

          onMouseMove: function (event) {
            if (!this.dragging) return;
            var dx = event.clientX - this.dragStartX;
            var dy = event.clientY - this.dragStartY;
            this.viewerOffsetX = this.dragStartOffsetX + dx;
            this.viewerOffsetY = this.dragStartOffsetY + dy;
          },

          onMouseUp: function () {
            this.dragging = false;
          },

          /* å·¥å…·æ–¹æ³• */

          formatBytes: function (bytes) {
            if (!bytes && bytes !== 0) return '';
            var kb = bytes / 1024;
            if (kb < 1024) return kb.toFixed(1) + ' KB';
            var mb = kb / 1024;
            return mb.toFixed(2) + ' MB';
          }
        },
        mounted: function () {
          this.initSvgaPlayer();
        }
      });
    </script>
  </body>
</html>