{"remainingRequest":"F:\\百度云同步盘\\BaiduSyncdisk\\04生活\\小工具\\a-viewer-main\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\百度云同步盘\\BaiduSyncdisk\\04生活\\小工具\\a-viewer-main\\.vuepress\\components\\aview.vue?vue&type=style&index=0&id=41a7aabf&scoped=true&lang=css","dependencies":[{"path":"F:\\百度云同步盘\\BaiduSyncdisk\\04生活\\小工具\\a-viewer-main\\.vuepress\\components\\aview.vue","mtime":1764567120830},{"path":"F:\\百度云同步盘\\BaiduSyncdisk\\04生活\\小工具\\a-viewer-main\\node_modules\\css-loader\\dist\\cjs.js","mtime":1765057400066},{"path":"F:\\百度云同步盘\\BaiduSyncdisk\\04生活\\小工具\\a-viewer-main\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1765057401262},{"path":"F:\\百度云同步盘\\BaiduSyncdisk\\04生活\\小工具\\a-viewer-main\\node_modules\\postcss-loader\\src\\index.js","mtime":1765057400229},{"path":"F:\\百度云同步盘\\BaiduSyncdisk\\04生活\\小工具\\a-viewer-main\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1765057400033},{"path":"F:\\百度云同步盘\\BaiduSyncdisk\\04生活\\小工具\\a-viewer-main\\node_modules\\vue-loader\\lib\\index.js","mtime":1765057400705}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci52aWV3ZXItYm94IHsKICAgIHBhZGRpbmc6IDEycHggMDsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiBhdXRvOwogICAgbWluLWhlaWdodDogMzAwcHg7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgcG9zaXRpb246IHJlbGF0aXZlOwogICAgbWFyZ2luLXRvcDogMjRweDsKICAgIGJvcmRlcjogMXB4IGRhc2hlZCAjY2NjOwp9Cgoudmlld2VyLXNjcmVlbiB7CiAgICB3aWR0aDogMTAwJTsKICAgIGhlaWdodDogYXV0bzsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBwb3NpdGlvbjogcmVsYXRpdmU7Cn0KCi8qIOaWsOWinu+8muminOiJsuaMiemSruagt+W8jyAqLwouY29sb3ItbGlzdCB7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZ2FwOiA4cHg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwp9Ci5jb2xvci1idG4gewogICAgd2lkdGg6IDI4cHg7CiAgICBoZWlnaHQ6IDI4cHg7CiAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICBib3JkZXI6IDFweCBzb2xpZCAjZGRkOwogICAgY3Vyc29yOiBwb2ludGVyOwogICAgcGFkZGluZzogMDsKfQouY29sb3ItYnRuLmFjdGl2ZSB7CiAgICBvdXRsaW5lOiAycHggc29saWQgIzQwOUVGRjsKICAgIG91dGxpbmUtb2Zmc2V0OiAycHg7Cn0KCi5pcy1tb2JpbGUgewogICAgYmFja2dyb3VuZDogIzMzMzsKfQoKLmlzLW1vYmlsZT4udmlld2VyLXNjcmVlbiB7CiAgICB3aWR0aDogMzc1cHg7CiAgICBoZWlnaHQ6IGF1dG87CiAgICB0b3A6IDBweDsKfQoKLnZpZXdlci11cGxvYWQgewogICAgcG9zaXRpb246IGFic29sdXRlOwogICAgd2lkdGg6IDEwMCU7CiAgICBoZWlnaHQ6IDEwMCU7Cn0KCi5pbnB1dCB7CiAgICB3aWR0aDogMTAwcHg7Cn0KCi5mcm9tIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBoZWlnaHQ6IDQwcHg7Cn0KCi5sYWJsZSB7CiAgICBtYXJnaW4tcmlnaHQ6IDEycHg7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKfQoKLmxhYmxlOjphZnRlciB7CiAgICBjb250ZW50OiAiIjsKICAgIGRpc3BsYXk6IGJsb2NrOwogICAgaGVpZ2h0OiA1MCU7CiAgICBib3JkZXItbGVmdDogMXB4IHNvbGlkICNjY2M7CiAgICBtYXJnaW4tbGVmdDogMTJweDsKfQo="},{"version":3,"sources":["aview.vue"],"names":[],"mappings":";AAuSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"aview.vue","sourceRoot":".vuepress/components","sourcesContent":["<template>\n    <div class=\"a-view\">\n        <div class=\"from\">\n            <div class=\"lable\">\n                <span>屏幕方向：</span>\n                <el-radio :label=\"1\" v-model=\"viewer\">横屏</el-radio>\n                <el-radio :label=\"2\" v-model=\"viewer\">竖屏</el-radio>\n            </div>\n\n            <div class=\"lable\">\n                <span>背景颜色：</span>\n                <div class=\"color-list\">\n                    <button\n                        v-for=\"c in colors\"\n                        :key=\"c\"\n                        class=\"color-btn\"\n                        :style=\"{ backgroundColor: c }\"\n                        :aria-label=\"c\"\n                        :class=\"{ active: c === color }\"\n                        @click=\"setColor(c)\"></button>\n                </div>\n            </div>\n        </div>\n        <div class=\"lable\">\n            <span>文件信息：</span>\n            <span>{{file.name}}</span>\n            &nbsp&nbsp\n            <span>{{fileSize}}</span>\n            <span v-if=\"file.fps\">&nbsp&nbsp帧率：{{file.fps}}</span>\n            <span v-if=\"file.width && file.height\">&nbsp&nbsp尺寸：{{file.width}}*{{file.height}}</span>\n        </div>\n\n        <div :class=\"['viewer-box', { 'is-mobile': viewer === 2 }]\">\n            <div class=\"viewer-screen\" :style=\"{ backgroundColor: color }\">\n                <div\n                    class=\"viewer\"\n                    id=\"demoCanvas\"\n                    ref=\"viewer\"></div>\n            </div>\n\n            <el-upload\n                v-if=\"animationShow === false\"\n                class=\"viewer-upload\"\n                drag\n                action=\"\"\n                :multiple=\"false\"\n                :show-file-list=\"false\"\n                :before-upload=\"handleBeforeUpload\">\n                <i class=\"el-icon-upload\"></i>\n                <div class=\"el-upload__text\">\n                    将文件拖到此处，或<em>点击上传</em>\n                </div>\n            </el-upload>\n        </div>\n    </div>\n</template>\n\n<script>\n// 播放容器尺寸：基于文件尺寸，最大宽度 1500，等比缩放；同步设置父容器 viewer-screen 高度\nfunction setContainerSize(container, w, h) {\n    const maxW = 1500;\n    if (!w || !h) { w = 200; h = 200; }\n    const width = Math.min(w, maxW);\n    const height = Math.round(h * (width / w));\n    container.style.width = width + 'px';\n    container.style.height = height + 'px';\n    const parent = container.parentElement;\n    if (parent && parent.classList.contains('viewer-screen')) {\n        parent.style.height = height + 'px';\n    }\n}\n\nclass Player {\n    constructor(file, container) {\n        this.data = '';\n        this.container = container;\n        this.player = null;\n    }\n    load() {}\n    init() {}\n    create() {}\n    destroy() {}\n    changeSize() {}\n}\n\nclass SvgaPlayer extends Player {\n    constructor(file, container, onMeta) {\n        super(file, container);\n        this.onMeta = onMeta;\n        this.url = null;\n        this.init(file);\n    }\n\n    load(file) {\n        return new Promise((resolve) => {\n            // 预先生成 Blob URL，作为 load 的主要输入\n            try { this.url = URL.createObjectURL(file); } catch (e) { this.url = null; }\n            // 同时读取 ArrayBuffer，作为备用\n            const reader = new FileReader();\n            reader.onload = (evt) => {\n                this.data = evt.target.result; // ArrayBuffer\n                resolve(this.data);\n            };\n            reader.readAsArrayBuffer(file);\n        });\n    }\n\n    init(file) {\n        this.load(file).then(() => {\n            this.create();\n        });\n    }\n\n    create() {\n        this.player = new SVGA.Player(this.container);\n        const parser = new SVGA.Parser();\n        const source = this.url || this.data; // 优先用 Blob URL，兼容 2.3.1\n        parser.load(source, (videoItem) => {\n            this.player.setVideoItem(videoItem);\n            const sz = videoItem.videoSize || {};\n            const fps = videoItem.FPS || videoItem.fps;\n\n            setContainerSize(this.container, sz.width, sz.height);\n\n            if (typeof this.onMeta === 'function') {\n                this.onMeta({\n                    type: 'svga',\n                    fps,\n                    width: sz.width,\n                    height: sz.height\n                });\n            }\n            this.player.startAnimation();\n        });\n    }\n\n    destroy() {\n        if (this.player) {\n            this.player.stopAnimation();\n            Array.from(this.container.children).forEach(el => el.remove());\n        }\n        if (this.url) {\n            try { URL.revokeObjectURL(this.url); } catch (e) {}\n            this.url = null;\n        }\n    }\n\n    changeSize() {\n        this.destroy();\n        this.create();\n    }\n}\n\nclass LottiePlayer extends Player {\n    constructor(file, container) {\n        super(file, container);\n        this.data = {};\n        this.init(file);\n    }\n\n    load(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n            reader.onload = evt => {\n                this.data = JSON.parse(evt.target.result);\n                resolve(this.data);\n            };\n            reader.readAsText(file);\n        });\n    }\n\n    init(file) {\n        this.load(file).then(() => {\n            this.create();\n        });\n    }\n\n    create() {\n        const w = this.data.w || this.data.width;\n        const h = this.data.h || this.data.height;\n        setContainerSize(this.container, w, h);\n\n        this.player = lottie.loadAnimation({\n            container: this.container,\n            renderer: 'canvas',\n            loop: true,\n            autoplay: true,\n            animationData: this.data,\n        });\n    }\n\n    destroy() {\n        if (this.player) {\n            this.player.stop();\n            this.player.destroy();\n        }\n    }\n\n    changeSize() {\n        this.destroy();\n        this.create();\n    }\n}\n\nexport default {\n    name: 'Aview',\n    data() {\n        return {\n            color: '#ffffff',\n            fromShow: false,\n            viewer: 1,\n            $player: null,\n            animationShow: false,\n            file: {\n                fps: null,\n                width: null,\n                height: null\n            },\n            colors: ['#000000', '#ffffff', '#00ff00', '#C0392B', '#F1C40D', '#00b4ff']\n        };\n    },\n    mounted() {\n        // 在播放区域继续拖入文件替换播放\n        const screen = this.$el.querySelector('.viewer-screen');\n        if (screen) {\n            const onDragOver = (e) => { e.preventDefault(); };\n            const onDrop = (e) => {\n                e.preventDefault();\n                const f = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];\n                if (f) { this.handleBeforeUpload(f); }\n            };\n            screen.addEventListener('dragover', onDragOver);\n            screen.addEventListener('drop', onDrop);\n            this._cleanupDragDrop = () => {\n                screen.removeEventListener('dragover', onDragOver);\n                screen.removeEventListener('drop', onDrop);\n            };\n        }\n    },\n    computed: {\n        fileSize() {\n            if (this.file.size) {\n                return Math.ceil(this.file.size / 1024) + 'kb'\n            }\n            return ''\n        },\n    },\n    methods: {\n        setColor(c) { this.color = c; },\n\n        updateSvgaMeta(meta) {\n            this.file.fps = meta.fps || null;\n            this.file.width = meta.width || null;\n            this.file.height = meta.height || null;\n        },\n        handleBeforeUpload(file) {\n            const name = (file && file.name) ? file.name : '';\n            const dom = this.$refs.viewer\n\n            console.log('[UPLOAD] receive file:', name, 'size=', file && file.size);\n\n            this.file.name = file.name\n            this.$set(this.file, 'size', file.size)\n\n            if (this.$player) {\n                this.$player.destroy();\n                this.animationShow = false;\n            }\n            if (/\\.svga$/i.test(name)) {\n                console.log('[SVGA] start load');\n                window.player = this.$player = new SvgaPlayer(file, dom, (meta) => {\n                    console.log('[SVGA] meta:', meta);\n                    this.updateSvgaMeta(meta)\n                })\n                this.animationShow = true;\n            }\n\n            if (/\\.json$/i.test(name)) {\n                console.log('[LOTTIE] start load');\n                window.player = this.$player = new LottiePlayer(file, dom)\n                this.file.fps = null;\n                this.file.width = null;\n                this.file.height = null;\n                this.animationShow = true;\n            }\n            return false\n        }\n    },\n    beforeDestroy() {\n        if (this._cleanupDragDrop) this._cleanupDragDrop();\n    }\n}\n</script>\n\n<style scoped>\n.viewer-box {\n    padding: 12px 0;\n    width: 100%;\n    height: auto;\n    min-height: 300px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    margin-top: 24px;\n    border: 1px dashed #ccc;\n}\n\n.viewer-screen {\n    width: 100%;\n    height: auto;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n}\n\n/* 新增：颜色按钮样式 */\n.color-list {\n    display: flex;\n    gap: 8px;\n    align-items: center;\n}\n.color-btn {\n    width: 28px;\n    height: 28px;\n    border-radius: 6px;\n    border: 1px solid #ddd;\n    cursor: pointer;\n    padding: 0;\n}\n.color-btn.active {\n    outline: 2px solid #409EFF;\n    outline-offset: 2px;\n}\n\n.is-mobile {\n    background: #333;\n}\n\n.is-mobile>.viewer-screen {\n    width: 375px;\n    height: auto;\n    top: 0px;\n}\n\n.viewer-upload {\n    position: absolute;\n    width: 100%;\n    height: 100%;\n}\n\n.input {\n    width: 100px;\n}\n\n.from {\n    display: flex;\n    height: 40px;\n}\n\n.lable {\n    margin-right: 12px;\n    display: flex;\n    align-items: center;\n}\n\n.lable::after {\n    content: \"\";\n    display: block;\n    height: 50%;\n    border-left: 1px solid #ccc;\n    margin-left: 12px;\n}\n</style>\n\n<style>\n.el-radio {\n    margin-right: 12px;\n}\n\n.el-input__suffix {\n    line-height: 28px;\n}\n\n.el-upload {\n    width: 100%;\n    height: 100%;\n}\n\n.el-upload-dragger {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-direction: column;\n    background-color: transparent;\n}\n\n.el-upload-dragger .el-icon-upload {\n    margin-top: 0px;\n}\n</style>\n"]}]}