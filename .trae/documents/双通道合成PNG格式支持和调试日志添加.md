# 双通道合成PNG格式支持和调试日志添加计划

## 问题分析

通过分析代码，我发现以下几个潜在问题：

1. **PNG格式支持问题**：
   - `composeFramesDualChannel`方法调用的是`composeToJPEG`，默认使用JPEG格式
   - 没有明确设置`format: 'png'`参数，可能导致PNG格式合成失败

2. **调试信息不足**：
   - 代码中有很多被注释掉的`console.log`语句
   - 关键节点缺少调试信息，难以定位问题

3. **进度报告可能不够细粒度**：
   - Web Worker中进度报告每10%一次，可能导致进度显示不流畅

## 修复计划

### 1. 确保PNG格式支持
- **修改`composeFramesDualChannel`方法**：
  - 添加`format`参数支持
  - 确保在调用合成器时正确传递格式参数

### 2. 添加调试日志
- **在关键节点添加调试信息**：
  - **帧提取过程**：记录提取的帧数、尺寸等信息
  - **合成过程**：记录合成开始/结束、处理的帧数
  - **Web Worker**：启用关键节点的日志，如块处理、像素处理等
  - **格式转换**：记录格式转换的结果和时间

### 3. 优化进度报告
- **增加进度报告的频率**：
  - 在Web Worker中增加进度报告的频率，从每10%一次改为每5%一次
  - 确保进度报告的准确性和连续性

### 4. 验证流程
- **测试PNG格式合成**：
  - 确保序列帧能正确合成为PNG格式
  - 验证生成的PNG文件格式正确
- **测试进度显示**：
  - 确保进度从0%到100%平滑显示
  - 验证没有卡顿或停滞现象

## 具体修改点

1. **`src/assets/js/core/app.js`**：
   - 修改`composeFramesDualChannel`方法，添加格式参数支持
   - 在帧提取和合成过程中添加调试日志

2. **`src/assets/js/service/dual-channel/dual-channel-composer.js`**：
   - 确保`composeFrames`方法正确处理格式参数
   - 添加合成过程的调试日志

3. **`src/assets/js/service/dual-channel/dual-channel-worker.js`**：
   - 启用关键节点的调试日志
   - 增加进度报告的频率

## 预期结果

- ✅ PNG格式合成功能正常工作
- ✅ 调试日志清晰显示整个处理流程
- ✅ 进度从0%到100%平滑显示，无卡顿
- ✅ 能够通过调试日志快速定位任何潜在问题