# 侧边弹窗技术规范文档

## 1. 概述

本文档定义了 MeeWoo 项目中侧边弹窗的技术规范，旨在统一弹窗的样式、交互和功能实现，避免重复造轮子，确保开发一致性。

## 2. 面板结构

### 2.1 基本结构

所有侧边弹窗遵循以下基本结构：

```html
<div class="side-panel side-panel--right [特定面板类]">
  <div class="side-panel-container">
    <!-- 标题区 -->
    <div class="side-panel-header">
      <h3 class="side-panel-title">面板标题</h3>
      <div class="side-panel-divider"></div>
    </div>

    <!-- 信息区 -->
    <div class="[类型]-info-section">
      <div class="[类型]-info-row">信息内容</div>
      <div class="[类型]-compress-hint">提示信息</div>
    </div>

    <!-- 配置区域 -->
    <div class="[类型]-config-section">
      <!-- 配置项 -->
    </div>

    <!-- 底部按钮 -->
    <div class="side-panel-footer">
      <!-- 按钮 -->
    </div>
  </div>
</div>
```

### 2.2 面板类型

| 面板类型    | 特定类名                   | 适用场景        |
| ------- | ---------------------- | ----------- |
| 转SVGA   | `to-svga-panel`        | 各类格式转SVGA   |
| 转双通道MP4 | `dual-channel-panel`   | 各类格式转双通道MP4 |
| 素材管理    | `material-panel`       | SVGA素材图管理   |
| GIF导出   | `svga-panel.gif-panel` | 导出GIF       |
| 绿幕抠图    | `chromakey-panel`      | MP4绿幕抠图     |
| 标准MP4   | `standard-mp4-panel`   | 标准MP4转换     |

## 3. 样式规范

### 3.1 基础样式

* **容器宽度**：统一设置为 `400px`

* **背景色**：白色 `#FFFFFF`，暗黑模式下为 `#1a1a1a`

* **边框**：1px 实线 `#e6e6e6`，暗黑模式下为 `#404040`

* **阴影**：显示时添加 `0px 10px 32px 0px rgba(51, 51, 51, 0.2)`

* **圆角**：统一使用 `16px` 圆角

### 3.2 动画效果

* **显示动画**：从右侧滑入，配合淡入效果

* **隐藏动画**：原地淡出后滑出

* **拖拽动画**：拖拽过程中禁用过渡动画，确保流畅体验

### 3.3 统一组件样式

#### 3.3.1 输入框

```html
<div class="input-wrapper input-wrapper--lg [类型]-size-input-wrapper">
  <input type="number" class="base-input" v-model.number="config.width" />
</div>
```

* **宽度**：统一设置为 `73px`

* **样式**：使用 `base-input` 类，确保与全局输入框样式一致

#### 3.3.2 选择器

```html
<div class="[类型]-select-wrapper">
  <div class="[类型]-select-text">选项文本</div>
  <div class="[类型]-select-icon">
    <svg>...</svg>
  </div>
  <div class="[类型]-select-dropdown">
    <div class="[类型]-select-option">选项1</div>
    <div class="[类型]-select-option">选项2</div>
  </div>
</div>
```

#### 3.3.3 开关

```html
<div class="[类型]-mute-toggle" :class="{active: config.muted}">
  <div class="[类型]-mute-toggle-handle"></div>
</div>
```

#### 3.3.4 按钮

* **取消按钮**：使用 `material-btn-back` 类

* **确认/转换按钮**：使用 `btn-large-secondary` 类

* **转换中状态**：添加 `[类型]-btn-converting` 类

## 4. 组件实现

### 4.1 组件结构

每个面板组件遵循以下结构：

```javascript
(function () {
  var template = `...`;

  window.MeeWoo = window.MeeWoo || {};
  window.MeeWoo.Components = window.MeeWoo.Components || {};

  window.MeeWoo.Components.[ComponentName] = {
    template: template,
    props: {
      // 组件属性
    },
    data: function () {
      return {
        // 组件数据
      };
    },
    watch: {
      // 监听器
    },
    methods: {
      // 组件方法
    }
  };
})();
```

### 4.2 标准 Props

| Prop            | 类型      | 描述          |
| --------------- | ------- | ----------- |
| `visible`       | Boolean | 控制面板显示/隐藏   |
| `sourceInfo`    | Object  | 源文件信息       |
| `initialConfig` | Object  | 初始配置        |
| `isConverting`  | Boolean | 是否正在转换      |
| `progress`      | Number  | 转换进度（0-100） |
| `message`       | String  | 转换状态消息      |
| `disabled`      | Boolean | 是否禁用操作      |

### 4.3 标准事件

| 事件        | 描述   | 参数   |
| --------- | ---- | ---- |
| `close`   | 关闭面板 | 无    |
| `cancel`  | 取消操作 | 无    |
| `convert` | 开始转换 | 配置对象 |

## 5. 状态管理

### 5.1 核心状态

使用 `panel-mixin.js` 管理面板状态：

* **`activeRightPanel`**：当前激活的右侧面板

* **各面板配置**：如 `toSvgaConfig`、`dualChannelConfig` 等

* **转换状态**：如 `isConvertingToSvga`、`dualChannelProgress` 等

### 5.2 状态管理流程

1. 父组件通过 `activeRightPanel` 控制面板显示
2. 面板组件通过 props 接收状态
3. 用户操作通过事件传递给父组件
4. 父组件更新状态并重新渲染

## 6. 交互逻辑

### 6.1 显示/隐藏逻辑

* **显示**：设置 `activeRightPanel` 为对应面板名称，同时为 `div.side-panel` 添加 `show` 类

* **隐藏**：设置 `activeRightPanel` 为 `null`，同时移除 `div.side-panel` 的 `show` 类

* **切换**：点击同一面板按钮时，将 `activeRightPanel` 设为 `null`，关闭面板

### 6.2 拖拽功能

所有侧边弹窗默认支持拖拽：

* **拖拽开始**：在 `div.side-panel-header` 上触发鼠标按下事件，为 `div.side-panel` 添加 `dragging` 类

* **拖拽过程**：`div.side-panel` 会跟随鼠标移动，此时禁用过渡动画

* **拖拽结束**：释放鼠标后，移除 `div.side-panel` 的 `dragging` 类，保存最终位置状态

* **关闭动画**：拖拽过的 `div.side-panel` 在关闭时会执行飞出去动画

### 6.3 转换流程

1. **配置修改**：用户在 `div.[类型]-config-section` 中修改配置项

2. **开始转换**：点击 `div.side-panel-footer` 中的转换按钮

3. **事件触发**：触发 `convert` 事件，传递配置对象

4. **转换开始**：父组件开始转换流程，为面板添加 `disabled` 类

5. **进度显示**：`div.side-panel-footer` 中的转换按钮显示转换进度和状态消息

6. **转换完成**：父组件更新状态，移除 `disabled` 类，恢复面板可操作性

## 7. 开发流程

### 7.1 新增面板步骤

1. **创建组件文件**：在 `src/assets/js/components/` 目录下创建新组件
2. **定义模板**：遵循基本结构定义面板模板
3. **实现组件逻辑**：添加 props、data、methods 等
4. **注册组件**：在 `window.MeeWoo.Components` 中注册
5. **添加样式**：在 `src/assets/css/panel.css` 中添加必要样式
6. **集成到主应用**：在 `index.html` 中添加组件引用
7. **添加状态管理**：在 `panel-mixin.js` 中添加对应状态

### 7.2 最佳实践

* **复用现有组件**：优先复用现有面板结构和样式

* **统一命名规范**：使用一致的类名和变量命名

* **遵循单向数据流**：通过 props 接收数据，通过事件传递操作

* **支持暗黑模式**：确保样式在暗黑模式下正常显示

* **添加适当提示**：为用户操作添加清晰的提示信息

* **处理边界情况**：如转换中状态、错误处理等

## 8. 示例代码

### 8.1 组件使用示例

```html
<to-svga-panel 
  :visible="activeRightPanel === 'to-svga'" 
  :source-info="toSvgaSourceInfo"
  :initial-config="toSvgaConfig"
  :is-converting="isConvertingToSvga"
  :progress="toSvgaProgress"
  :message="toSvgaMessage"
  :disabled="isGlobalTaskRunning"
  @close="closeRightPanel"
  @cancel="cancelToSvgaConversion"
  @convert="handleToSvgaConvert">
</to-svga-panel>
```

### 8.2 面板打开示例

```javascript
openToSvgaPanel: function () {
  // 设置源信息
  var sourceInfo = {
    name: '',
    sizeWH: '',
    duration: '',
    fileSize: '',
    fps: 30,
    typeLabel: ''
  };
  
  // 设置配置
  var config = {
    width: 0,
    height: 0,
    quality: 80,
    fps: 30,
    muted: false,
    aspectRatio: 1
  };
  
  // 更新状态
  this.toSvgaSourceInfo = sourceInfo;
  this.toSvgaConfig = config;
  this.activeRightPanel = 'to-svga';
}
```

## 9. 总结

本规范文档为 MeeWoo 项目中的侧边弹窗开发提供了统一的技术标准，涵盖了结构、样式、组件实现、状态管理和交互逻辑等方面。遵循此规范可以确保弹窗开发的一致性和高效性，提升用户体验。

## 10. 版本历史

| 版本  | 日期         | 变更内容 |
| --- | ---------- | ---- |
| 1.0 | 2026-02-06 | 初始版本 |

