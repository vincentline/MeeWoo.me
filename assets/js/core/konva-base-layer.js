!function(e){"use strict";e.MeeWoo=e.MeeWoo||{},e.MeeWoo.Core=e.MeeWoo.Core||{};var a={initBaseLayer:function(e,a){if("undefined"==typeof Konva)throw new Error("Konva library not loaded");var t=e.layers.backgroundLayer;if(!t)throw new Error("Background layer not found");var i=new Konva.Image({image:null,x:0,y:0,width:0,height:0,visible:a.editor.showImage});t.add(i);var n={baseImage:i,stageInstance:e,vueInstance:a,isInitialized:!0};return this.initBaseLayerEvents(n),this.syncState(n),n},initBaseLayerEvents:function(e){var a=e.baseImage,t=e.vueInstance;a.on("click tap",function(e){e.cancelBubble=!0,t.editor.activeElement="image",t.editor.lastClickElement="image",t.editor.lastClickTime=Date.now()}),a.on("dragstart",function(){t.editor.isImageDragging=!0,t.editor.imageDragStartX=t.editor.imageOffsetX,t.editor.imageDragStartY=t.editor.imageOffsetY}),a.on("dragmove",function(){var e=a.position();t.editor.imageOffsetX=e.x,t.editor.imageOffsetY=e.y}),a.on("dragend",function(){t.editor.isImageDragging=!1,t.updateRestoreBtnState&&t.updateRestoreBtnState()})},syncState:function(e){var a=e.baseImage,t=e.vueInstance;a.visible(t.editor.showImage),a.position({x:t.editor.imageOffsetX,y:t.editor.imageOffsetY}),a.scale({x:t.editor.imageScale,y:t.editor.imageScale}),e.stageInstance.layers.backgroundLayer.draw()},updateBaseImage:function(e,a){var t=e.baseImage,i=e.vueInstance;if("string"==typeof a){var n=new Image;n.onload=function(){t.image(n),t.width(n.width),t.height(n.height),i.editor.baseImageWidth=n.width,i.editor.baseImageHeight=n.height,e.stageInstance.layers.backgroundLayer.draw()},n.onerror=function(){console.error("Failed to load base image")},n.crossOrigin="Anonymous",n.src=a}else a instanceof HTMLImageElement&&(t.image(a),t.width(a.width),t.height(a.height),i.editor.baseImageWidth=a.width,i.editor.baseImageHeight=a.height,e.stageInstance.layers.backgroundLayer.draw())},setBaseImageVisible:function(e,a){e.baseImage.visible(a),e.stageInstance.layers.backgroundLayer.draw()},setBaseImagePosition:function(e,a,t){e.baseImage.position({x:a,y:t}),e.stageInstance.layers.backgroundLayer.draw()},setBaseImageScale:function(e,a){e.baseImage.scale({x:a,y:a}),e.stageInstance.layers.backgroundLayer.draw()},setBaseImageDraggable:function(e,a){e.baseImage.draggable(a)},destroyBaseLayer:function(e){var a=e.baseImage;a&&(a.off("click tap"),a.off("dragstart"),a.off("dragmove"),a.off("dragend"),a.remove()),e.isInitialized=!1,e.baseImage=null,e.stageInstance=null,e.vueInstance=null}};e.MeeWoo.Core.KonvaBaseLayer=a}(window);