<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¼–è¾‘å™¨åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0069d9;
        }
        .log {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        .response-time {
            font-size: 12px;
            color: #666;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ç¼–è¾‘å™¨åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>æµ‹è¯•é…ç½®</h2>
            <p>æµ‹è¯•æ–‡ä»¶: <strong>test_files/test.svga</strong></p>
            <p>æµ‹è¯•ç›®æ ‡: <strong>http://localhost:4005</strong></p>
            <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>
        
        <div class="test-section">
            <h2>åº”ç”¨åŠ è½½</h2>
            <iframe id="appFrame" src="http://localhost:4005"></iframe>
        </div>
        
        <div class="test-section">
            <h2>æµ‹è¯•ç»“æœ</h2>
            <div id="testResults"></div>
        </div>
        
        <div class="test-section">
            <h2>æµ‹è¯•æ—¥å¿—</h2>
            <div id="testLog" class="log"></div>
        </div>
    </div>
    
    <script>
        // æµ‹è¯•ç»“æœå­˜å‚¨
        const testResults = [];
        
        // æµ‹è¯•æ–‡ä»¶è·¯å¾„
        const testFilePath = 'test_files/test.svga';
        
        // æ—¥å¿—è®°å½•å‡½æ•°
        function log(message) {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addTestResult(name, passed, message, responseTime) {
            const resultsDiv = document.getElementById('testResults');
            const resultClass = passed ? 'pass' : 'fail';
            const statusIcon = passed ? 'âœ…' : 'âŒ';
            const responseTimeStr = responseTime ? ` <span class="response-time">(${responseTime.toFixed(2)}ms)</span>` : '';
            
            resultsDiv.innerHTML += `
                <div class="test-result ${resultClass}">
                    <strong>${statusIcon} ${name}${responseTimeStr}</strong>
                    ${message ? `<p>${message}</p>` : ''}
                </div>
            `;
            
            testResults.push({ name, passed, message, responseTime });
        }
        
        // æ¸…ç©ºç»“æœ
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('testLog').innerHTML = '';
            testResults.length = 0;
            log('æµ‹è¯•ç»“æœå·²æ¸…ç©º');
        }
        
        // è·å–iframeä¸­çš„åº”ç”¨
        function getApp() {
            const frame = document.getElementById('appFrame');
            return frame.contentWindow;
        }
        
        // è·å–iframeä¸­çš„æ–‡æ¡£
        function getAppDocument() {
            const frame = document.getElementById('appFrame');
            return frame.contentDocument || frame.contentWindow.document;
        }
        
        // æµ‹è¯•1: ä¸Šä¼ æµ‹è¯•æ–‡ä»¶
        function testFileUpload() {
            return new Promise((resolve) => {
                log('å¼€å§‹æµ‹è¯•: ä¸Šä¼ æµ‹è¯•æ–‡ä»¶');
                const startTime = performance.now();
                
                // ç­‰å¾…iframeåŠ è½½å®Œæˆ
                setTimeout(() => {
                    try {
                        const doc = getAppDocument();
                        const fileInput = doc.querySelector('input[type="file"]');
                        
                        if (fileInput) {
                            // ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæ— æ³•ç›´æ¥é€šè¿‡JavaScriptè®¾ç½®æ–‡ä»¶è·¯å¾„
                            // è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ æ“ä½œ
                            log('æ–‡ä»¶ä¸Šä¼ åŒºåŸŸå¯è§');
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('ä¸Šä¼ æµ‹è¯•æ–‡ä»¶', true, 'æ–‡ä»¶ä¸Šä¼ åŒºåŸŸå¯è§', responseTime);
                            resolve(true);
                        } else {
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('ä¸Šä¼ æµ‹è¯•æ–‡ä»¶', false, 'æ–‡ä»¶ä¸Šä¼ åŒºåŸŸä¸å¯è§', responseTime);
                            resolve(false);
                        }
                    } catch (error) {
                        const endTime = performance.now();
                        const responseTime = endTime - startTime;
                        addTestResult('ä¸Šä¼ æµ‹è¯•æ–‡ä»¶', false, `ä¸Šä¼ æ–‡ä»¶æ—¶å‡ºé”™: ${error.message}`, responseTime);
                        resolve(false);
                    }
                }, 3000); // ç­‰å¾…3ç§’è®©åº”ç”¨åŠ è½½
            });
        }
        
        // æµ‹è¯•2: æ’­æ”¾æ§åˆ¶
        function testPlaybackControls() {
            return new Promise((resolve) => {
                log('å¼€å§‹æµ‹è¯•: æ’­æ”¾æ§åˆ¶');
                const startTime = performance.now();
                
                setTimeout(() => {
                    try {
                        const doc = getAppDocument();
                        const playButton = doc.querySelector('button:has-text("æ’­æ”¾")') || doc.querySelector('button:nth-child(1)');
                        const pauseButton = doc.querySelector('button:has-text("æš‚åœ")') || doc.querySelector('button:nth-child(1)');
                        
                        if (playButton || pauseButton) {
                            log('æ’­æ”¾æ§åˆ¶å¯è§');
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('æ’­æ”¾æ§åˆ¶', true, 'æ’­æ”¾æ§åˆ¶åŠŸèƒ½æ­£å¸¸', responseTime);
                            resolve(true);
                        } else {
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('æ’­æ”¾æ§åˆ¶', false, 'æ’­æ”¾æ§åˆ¶ä¸å¯è§', responseTime);
                            resolve(false);
                        }
                    } catch (error) {
                        const endTime = performance.now();
                        const responseTime = endTime - startTime;
                        addTestResult('æ’­æ”¾æ§åˆ¶', false, `æµ‹è¯•æ’­æ”¾æ§åˆ¶æ—¶å‡ºé”™: ${error.message}`, responseTime);
                        resolve(false);
                    }
                }, 2000);
            });
        }
        
        // æµ‹è¯•3: ç´ ææ›¿æ¢åŠŸèƒ½
        function testMaterialReplacement() {
            return new Promise((resolve) => {
                log('å¼€å§‹æµ‹è¯•: ç´ ææ›¿æ¢åŠŸèƒ½');
                const startTime = performance.now();
                
                setTimeout(() => {
                    try {
                        const doc = getAppDocument();
                        const materialButton = doc.querySelector('text=ç´ æ') || doc.querySelector('button:contains("ç´ æ")') || doc.querySelector('.material-button');
                        
                        if (materialButton) {
                            log('ç´ ææŒ‰é’®å¯è§');
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('ç´ ææ›¿æ¢', true, 'ç´ ææ›¿æ¢åŠŸèƒ½æ­£å¸¸', responseTime);
                            resolve(true);
                        } else {
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('ç´ ææ›¿æ¢', false, 'ç´ ææŒ‰é’®ä¸å¯è§', responseTime);
                            resolve(false);
                        }
                    } catch (error) {
                        const endTime = performance.now();
                        const responseTime = endTime - startTime;
                        addTestResult('ç´ ææ›¿æ¢', false, `æµ‹è¯•ç´ ææ›¿æ¢æ—¶å‡ºé”™: ${error.message}`, responseTime);
                        resolve(false);
                    }
                }, 2000);
            });
        }
        
        // æµ‹è¯•4: æ–‡å­—ç¼–è¾‘åŠŸèƒ½
        function testTextEditing() {
            return new Promise((resolve) => {
                log('å¼€å§‹æµ‹è¯•: æ–‡å­—ç¼–è¾‘åŠŸèƒ½');
                const startTime = performance.now();
                
                setTimeout(() => {
                    try {
                        const doc = getAppDocument();
                        const textInput = doc.querySelector('input[placeholder="è¯·è¾“å…¥æ–‡å­—"]') || doc.querySelector('.text-input');
                        
                        if (textInput) {
                            log('æ–‡å­—è¾“å…¥æ¡†å¯è§');
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('æ–‡å­—ç¼–è¾‘', true, 'æ–‡å­—ç¼–è¾‘åŠŸèƒ½æ­£å¸¸', responseTime);
                            resolve(true);
                        } else {
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('æ–‡å­—ç¼–è¾‘', false, 'æ–‡å­—è¾“å…¥æ¡†ä¸å¯è§', responseTime);
                            resolve(false);
                        }
                    } catch (error) {
                        const endTime = performance.now();
                        const responseTime = endTime - startTime;
                        addTestResult('æ–‡å­—ç¼–è¾‘', false, `æµ‹è¯•æ–‡å­—ç¼–è¾‘æ—¶å‡ºé”™: ${error.message}`, responseTime);
                        resolve(false);
                    }
                }, 2000);
            });
        }
        
        // æµ‹è¯•5: çŠ¶æ€ç®¡ç†
        function testStateManagement() {
            return new Promise((resolve) => {
                log('å¼€å§‹æµ‹è¯•: çŠ¶æ€ç®¡ç†');
                const startTime = performance.now();
                
                setTimeout(() => {
                    try {
                        const doc = getAppDocument();
                        const restoreButton = doc.querySelector('text=æ¢å¤æ’­æ”¾') || doc.querySelector('button:contains("æ¢å¤")') || doc.querySelector('.restore-button');
                        
                        if (restoreButton) {
                            log('æ¢å¤æ’­æ”¾æŒ‰é’®å¯è§');
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('çŠ¶æ€ç®¡ç†', true, 'çŠ¶æ€ç®¡ç†åŠŸèƒ½æ­£å¸¸', responseTime);
                            resolve(true);
                        } else {
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('çŠ¶æ€ç®¡ç†', false, 'æ¢å¤æ’­æ”¾æŒ‰é’®ä¸å¯è§', responseTime);
                            resolve(false);
                        }
                    } catch (error) {
                        const endTime = performance.now();
                        const responseTime = endTime - startTime;
                        addTestResult('çŠ¶æ€ç®¡ç†', false, `æµ‹è¯•çŠ¶æ€ç®¡ç†æ—¶å‡ºé”™: ${error.message}`, responseTime);
                        resolve(false);
                    }
                }, 2000);
            });
        }
        
        // æµ‹è¯•6: å¯¼å‡ºåŠŸèƒ½
        function testExportFunctions() {
            return new Promise((resolve) => {
                log('å¼€å§‹æµ‹è¯•: å¯¼å‡ºåŠŸèƒ½');
                const startTime = performance.now();
                
                setTimeout(() => {
                    try {
                        const doc = getAppDocument();
                        const exportButton = doc.querySelector('text=å¯¼å‡º') || doc.querySelector('button:contains("å¯¼å‡º")') || doc.querySelector('.export-button');
                        
                        if (exportButton) {
                            log('å¯¼å‡ºæŒ‰é’®å¯è§');
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('å¯¼å‡ºåŠŸèƒ½', true, 'å¯¼å‡ºåŠŸèƒ½æ­£å¸¸', responseTime);
                            resolve(true);
                        } else {
                            const endTime = performance.now();
                            const responseTime = endTime - startTime;
                            addTestResult('å¯¼å‡ºåŠŸèƒ½', false, 'å¯¼å‡ºæŒ‰é’®ä¸å¯è§', responseTime);
                            resolve(false);
                        }
                    } catch (error) {
                        const endTime = performance.now();
                        const responseTime = endTime - startTime;
                        addTestResult('å¯¼å‡ºåŠŸèƒ½', false, `æµ‹è¯•å¯¼å‡ºåŠŸèƒ½æ—¶å‡ºé”™: ${error.message}`, responseTime);
                        resolve(false);
                    }
                }, 2000);
            });
        }
        
        // æµ‹è¯•7: æ€§èƒ½å’Œå“åº”æ—¶é—´
        function testPerformance() {
            return new Promise((resolve) => {
                log('å¼€å§‹æµ‹è¯•: æ€§èƒ½å’Œå“åº”æ—¶é—´');
                const startTime = performance.now();
                
                setTimeout(() => {
                    try {
                        const doc = getAppDocument();
                        
                        // æµ‹è¯•é¡µé¢åŠ è½½æ—¶é—´
                        const loadTime = performance.now() - startTime;
                        log(`é¡µé¢åŠ è½½æ—¶é—´: ${loadTime.toFixed(2)}ms`);
                        
                        // æµ‹è¯•DOMæ“ä½œå“åº”æ—¶é—´
                        const domStartTime = performance.now();
                        const bodyElement = doc.body;
                        const domEndTime = performance.now();
                        const domResponseTime = domEndTime - domStartTime;
                        log(`DOMæ“ä½œå“åº”æ—¶é—´: ${domResponseTime.toFixed(2)}ms`);
                        
                        // æ‰€æœ‰æ“ä½œå“åº”æ—¶é—´éƒ½åº”å°äº100ms
                        const performancePassed = loadTime < 3000 && domResponseTime < 100;
                        
                        const endTime = performance.now();
                        const responseTime = endTime - startTime;
                        
                        if (performancePassed) {
                            addTestResult('æ€§èƒ½æµ‹è¯•', true, 'æ€§èƒ½å’Œå“åº”æ—¶é—´æ­£å¸¸', responseTime);
                            resolve(true);
                        } else {
                            addTestResult('æ€§èƒ½æµ‹è¯•', false, 'æ€§èƒ½æˆ–å“åº”æ—¶é—´å¼‚å¸¸', responseTime);
                            resolve(false);
                        }
                    } catch (error) {
                        const endTime = performance.now();
                        const responseTime = endTime - startTime;
                        addTestResult('æ€§èƒ½æµ‹è¯•', false, `æµ‹è¯•æ€§èƒ½æ—¶å‡ºé”™: ${error.message}`, responseTime);
                        resolve(false);
                    }
                }, 2000);
            });
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            log('å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            clearResults();
            
            // æµ‹è¯•1: ä¸Šä¼ æµ‹è¯•æ–‡ä»¶
            await testFileUpload();
            
            // æµ‹è¯•2: æ’­æ”¾æ§åˆ¶
            await testPlaybackControls();
            
            // æµ‹è¯•3: ç´ ææ›¿æ¢åŠŸèƒ½
            await testMaterialReplacement();
            
            // æµ‹è¯•4: æ–‡å­—ç¼–è¾‘åŠŸèƒ½
            await testTextEditing();
            
            // æµ‹è¯•5: çŠ¶æ€ç®¡ç†
            await testStateManagement();
            
            // æµ‹è¯•6: å¯¼å‡ºåŠŸèƒ½
            await testExportFunctions();
            
            // æµ‹è¯•7: æ€§èƒ½å’Œå“åº”æ—¶é—´
            await testPerformance();
            
            // ç”Ÿæˆæµ‹è¯•æ€»ç»“
            generateTestSummary();
        }
        
        // ç”Ÿæˆæµ‹è¯•æ€»ç»“
        function generateTestSummary() {
            const totalTests = testResults.length;
            const passedTests = testResults.filter(result => result.passed).length;
            const failedTests = totalTests - passedTests;
            const successRate = (passedTests / totalTests * 100).toFixed(1);
            
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML += `
                <div class="test-result ${failedTests === 0 ? 'pass' : 'fail'}">
                    <h3>æµ‹è¯•æ€»ç»“</h3>
                    <p>æ€»æµ‹è¯•æ•°: ${totalTests}</p>
                    <p>é€šè¿‡æµ‹è¯•: ${passedTests}</p>
                    <p>å¤±è´¥æµ‹è¯•: ${failedTests}</p>
                    <p>æˆåŠŸç‡: ${successRate}%</p>
                    <p>${failedTests === 0 ? 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ç¼–è¾‘åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚' : 'ğŸ’¥ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥ã€‚'}</p>
                </div>
            `;
            
            log(`æµ‹è¯•æ€»ç»“: ${passedTests}/${totalTests} é€šè¿‡ (${successRate}%)`);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œæµ‹è¯•ç¯å¢ƒå‡†å¤‡å°±ç»ª');
            log('è¯·ç‚¹å‡»"è¿è¡Œæ‰€æœ‰æµ‹è¯•"æŒ‰é’®å¼€å§‹æµ‹è¯•');
        };
    </script>
</body>
</html>
